<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>📋 متجر PIZZA HOT</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    * { box-sizing:border-box }
    body{margin:0;font-family:'Tajawal',sans-serif;background:#f2f2f2;color:#333;line-height:1.6}
    header{position:fixed;top:0;width:100%;background:#0008;color:#ffd700;text-align:center;padding:10px;z-index:10}
    header a{margin:0 8px;color:inherit;text-decoration:none;font-weight:700}
    .overlay{padding:70px 10px 160px;background:#fff;min-height:100vh}
    h1{text-align:center;color:#d25f00;margin:20px 0;font-size:clamp(1.8rem,5vw,2.5rem)}
    .section{max-width:900px;margin:30px auto;padding:0 10px}
    h2{text-align:center;color:#b14c00;margin-bottom:12px}
    .table-wrapper{overflow-x:auto;border:1px solid #ddd;border-radius:6px;background:#fff;margin-bottom:20px}
    table{width:100%;border-collapse:collapse;font-size:1rem}
    th,td{text-align:center;border:1px solid #ddd;padding:8px}
    th{background:#ff914d;color:#fff}
    tr:nth-child(even) td{background:#f9ddb6}
    select.size,input.qty{padding:6px;border:1px solid #ccc;border-radius:4px;text-align:center}
    input.qty{width:60px}
    button.add-btn{background:#ffd700;border:none;padding:6px 12px;border-radius:6px;font-weight:700;cursor:pointer}
    button.add-btn:hover{background:#ffc107}
    .footer{text-align:center;color:#666;padding:20px;margin-top:20px;border-top:1px dashed #ccc}
    .cart-tab ul { padding: 0; list-style: none; margin: 10px 0 }
    .cart-tab li { margin-bottom: 6px; font-size: 0.95rem }
    .cart-tab .btn { display: inline-block; margin: 6px 4px; padding: 6px 10px; background: #25d366; color: #fff; border-radius: 6px; text-decoration: none }
    .cart-tab .btn.card { background: #007bff }
    .cart-tab .remove-item { background: none; border: none; color: #f44336; cursor: pointer; font-size: 1rem }
    .cart-tab strong { display: block; margin-bottom: 6px }
    .active { background: #ffd700; color: #000 !important }
  </style>
</head>
<body>

<header>
  <a href="index.html">🏠 الرئيسية</a>
  <a href="promo_offer.html">🔥 العرض</a>
  <a href="store.html">🛒 المتجر</a>
</header>

<div class="overlay">
  <h1>📋 متجر PIZZA HOT</h1>

  <!-- 🍕 قائمة البيتزا -->
  <!-- ... جداول المنتجات كما هي بدون تغيير ... -->

  <!-- 🛒 السلة الجانبية -->
  <div id="cart-manager" style="position:fixed;bottom:10px;left:10px;width:320px;background:#fff;padding:12px;border:1px solid #ccc;border-radius:6px;z-index:20">
    <input id="user-name" placeholder="اسمك (اختياري)" />
    <input id="user-address" placeholder="العنوان/هاتف (اختياري)" />
    <button id="start-btn">☑ بدء الطلب</button>
    <div id="cart-controls" style="display:none">
      <button id="add-cart">➕ سلة جديدة</button>
      <input id="cart-name" placeholder="اسم السلة" />
      <button id="save-cart">💾 حفظ</button>
      <select id="load-cart"></select>
      <button id="delete-cart">🗑️ حذف</button>
      <div id="cart-tabs"></div>
    </div>
  </div>
</div>

<script>
  let userName = '', userAddr = '', key = '', carts = {}, cur = null;
  const nameIn = document.getElementById('user-name'),
        addrIn = document.getElementById('user-address'),
        startBtn = document.getElementById('start-btn'),
        controls = document.getElementById('cart-controls'),
        addBtn = document.getElementById('add-cart'),
        cartNameIn = document.getElementById('cart-name'),
        saveBtn = document.getElementById('save-cart'),
        loadSel = document.getElementById('load-cart'),
        delBtn = document.getElementById('delete-cart'),
        tabsDiv = document.getElementById('cart-tabs'),
        mgr = document.getElementById('cart-manager');

  function loadData(){
    userName = localStorage.getItem('userName')||'';
    userAddr = localStorage.getItem('userAddr')||'';
    key = 'orders_' + (userName||'guest');
    const d = JSON.parse(localStorage.getItem(key)||'{}');
    carts = d.carts || {'1':[]}; cur = d.cur || '1';
  }

  function saveData(){
    localStorage.setItem('userName', userName);
    localStorage.setItem('userAddr', userAddr);
    localStorage.setItem(key, JSON.stringify({ carts, cur }));
  }

  function buildTabs(){
    tabsDiv.innerHTML = ''; loadSel.innerHTML = '';
    for(const name in carts){
      const b = document.createElement('button');
      b.textContent = name; b.dataset.cart = name;
      b.onclick = ()=>selectCart(name);
      tabsDiv.appendChild(b);
      const o = document.createElement('option');
      o.value = name; o.textContent = name; loadSel.append(o);
    }
    selectCart(cur);
  }

  function selectCart(name){
    cur = name; saveData();
    tabsDiv.querySelectorAll('button')
      .forEach(b=>b.classList.toggle('active', b.dataset.cart===name));
    document.querySelectorAll('.cart-tab').forEach(e=>e.remove());
    const d = document.createElement('div');
    d.id = 'cart-'+name; d.className='cart-tab active';
    d.innerHTML = `
      <strong>🧺 سلة: ${name}</strong>
      <ul id="items-${name}"></ul>
      <div><strong>📦 الإجمالي:</strong> <span id="total-${name}">0₪</span></div>
      <button id="clear-${name}">🚮 تفريغ</button><br>
      <a id="wa-${name}" class="btn whatsapp" href="#" target="_blank">واتساب</a>
      <a id="card-${name}" class="btn card" href="#" target="_blank">بطاقة</a>`;
    mgr.appendChild(d);
    d.querySelector(`#clear-${name}`).onclick = ()=>{
      carts[name]=[]; saveData(); renderCart(name);
    };
    renderCart(name);
  }

  function renderCart(name){
    const ul = document.getElementById('items-'+name),
          ttl = document.getElementById('total-'+name),
          wa  = document.getElementById('wa-'+name),
          cd  = document.getElementById('card-'+name);
    ul.innerHTML = carts[name].length === 0
      ? '<li style="text-align:center;color:#999">🧺 السلة فارغة حاليًا</li>'
      : '';
    let sum=0,
    msg = `مرحبًا ${userName||'ضيف'}%0A`; if(userAddr) msg += `📍 ${userAddr}%0A`;
    msg += `طلب:%0A`;
    carts[name].forEach((it,i)=>{
      const lt = it.price*it.qty; sum+=lt;
      const li = document.createElement('li');
      li.innerHTML = `${it.item} (${it.qty}) – ${lt}₪ <button class="remove-item" data-i="${i}">❌</button>`;
      ul.appendChild(li);
      li.querySelector('.remove-item').onclick = ()=>{
        carts[name].splice(i,1); saveData(); renderCart(name);
      };
      msg += `• ${it.item} (${it.qty}) – ${lt}₪%0A`;
    });
        ttl.textContent = sum + '₪';
    const encodedMsg = encodeURIComponent(msg);
    wa.href = `https://wa.me/?text=${encodedMsg}`;
    cd.href = `https://example.com/payment?name=${encodeURIComponent(userName)}&total=${sum}&cart=${encodeURIComponent(JSON.stringify(carts[name]))}`;
  }

  // بدء التشغيل
  startBtn.onclick = () => {
    userName = nameIn.value.trim();
    userAddr = addrIn.value.trim();
    key = 'orders_' + (userName || 'guest');
    controls.style.display = 'block';
    saveData();
    buildTabs();
  };

  addBtn.onclick = () => {
    const newName = cartNameIn.value.trim();
    if (newName && !carts[newName]) {
      carts[newName] = [];
      cur = newName;
      saveData();
      buildTabs();
    }
  };

  saveBtn.onclick = () => saveData();

  loadSel.onchange = () => selectCart(loadSel.value);

  delBtn.onclick = () => {
    const sel = loadSel.value;
    if (sel && carts[sel]) {
      delete carts[sel];
      cur = Object.keys(carts)[0] || '1';
      saveData();
      buildTabs();
    }
  };

  // تحميل البيانات عند التشغيل
  loadData();
  buildTabs();
</script>

</body>
</html>
